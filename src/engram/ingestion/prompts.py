"""LLM prompts for knowledge extraction."""

CONCEPT_EXTRACTION_PROMPT = """Извлеки концепты (сущности, идеи, термины) из текста.

Текст:
{content}

Для каждого концепта укажи:
- name: название (нормализованное, в нижнем регистре, на английском если технический термин)
- type: один из [tool, resource, action, state, config, error, general]
- description: краткое определение если понятно из текста (или null)

Также укажи связи между концептами:
- source: название исходного концепта
- target: название целевого концепта
- type: один из [uses, needs, causes, contains, is_a, related_to]

Выведи ТОЛЬКО валидный JSON в формате:
{{
  "concepts": [
    {{"name": "docker", "type": "tool", "description": "платформа контейнеризации"}}
  ],
  "relations": [
    {{"source": "docker", "target": "container", "type": "uses"}}
  ]
}}

Не добавляй комментарии или пояснения, только JSON."""


MEMORY_EXTRACTION_PROMPT = """Извлеки единицы знаний из документа.

Документ: {title}
Содержимое:
{content}

Извлеки:
1. ФАКТЫ — определения, описания ("X это Y", "X представляет собой Y")
2. ПРОЦЕДУРЫ — инструкции ("чтобы сделать X, нужно Y", "для X используй Y")
3. СВЯЗИ — зависимости ("X требует Y", "X влияет на Y", "X связан с Y")

Для каждой единицы знания укажи:
- content: текст знания (одно-два предложения, полные и понятные без контекста)
- type: один из [fact, procedure, relationship]
- concepts: список связанных концептов (названия в нижнем регистре)
- importance: 1-10 (насколько критично знать: 1=тривиально, 10=критически важно)

Выведи ТОЛЬКО валидный JSON в формате:
{{
  "memories": [
    {{
      "content": "Docker использует контейнеры для изоляции приложений",
      "type": "fact",
      "concepts": ["docker", "container", "isolation"],
      "importance": 8
    }},
    {{
      "content": "Чтобы освободить место на диске, выполните docker system prune",
      "type": "procedure",
      "concepts": ["docker", "disk space", "prune"],
      "importance": 7
    }}
  ]
}}

Извлеки 5-15 единиц знаний. Каждая должна быть самодостаточной.
Не добавляй комментарии или пояснения, только JSON."""


BEHAVIOR_EXTRACTION_PROMPT = """Проанализируй ответ и извлеки стратегию рассуждения.

Вопрос пользователя: {query}
Ответ системы: {answer}

Опиши использованную стратегию в формате:
- name: краткое имя на английском в snake_case (например: check_disk_usage, explain_concept)
- instruction: одно предложение описывающее паттерн рассуждения
- domain: область применения (docker, kubernetes, general, и т.д.)

Выведи ТОЛЬКО валидный JSON:
{{
  "name": "check_disk_usage",
  "instruction": "Проверить использование диска командой df -h, найти крупнейших потребителей",
  "domain": "docker"
}}"""


CONSOLIDATION_PROMPT = """Эти похожие вопросы успешно решались одинаковым подходом:

{episodes}

Извлеки общий паттерн знания в формате:
"Когда [ситуация], [действие] потому что [причина]"

Будь кратким и общим, не привязывайся к конкретным деталям.
Выведи только текст паттерна, без JSON."""


REFLECTION_PROMPT = """Проанализируй недавние взаимодействия и извлеки высокоуровневые инсайты:

{episodes}

Сгенерируй 2-3 обобщения:
- Какие темы/проблемы повторяются?
- Какие подходы работают лучше всего?
- Какие пробелы в знаниях выявились?

Каждый инсайт должен быть связан с конкретными концептами.

Выведи JSON:
{{
  "reflections": [
    {{
      "content": "Пользователи часто сталкиваются с проблемами дискового пространства Docker",
      "concepts": ["docker", "disk space"],
      "type": "pattern"
    }}
  ]
}}"""


RESPONSE_SYNTHESIS_PROMPT = """Вопрос пользователя: {query}

Релевантные знания:
{context}

Прошлые похожие рассуждения (используй как шаблон если применимо):
{episodes}

Дай полезный ответ. Если это вопрос "что такое X" — объясни концепцию.
Если это проблема — предложи решение пошагово.
Упомяни если уверенность в информации низкая.

Также кратко опиши свою стратегию рассуждения одним предложением
в формате: СТРАТЕГИЯ: [название_поведения] — [краткое описание]"""


RE_REASONING_PROMPT = """Предыдущий подход не помог: {failed_behavior}

Вопрос пользователя: {query}

Попробуй альтернативный подход используя эти знания:
{alternative_memories}

Успешные альтернативные подходы в похожих ситуациях:
{alternative_episodes}

Предложи другое решение или задай уточняющий вопрос если нужна дополнительная информация.

СТРАТЕГИЯ: [название_поведения] — [краткое описание]"""
